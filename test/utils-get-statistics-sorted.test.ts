import { expect, test } from 'vitest'

import { getStatisticsSorted, type SortedSamples } from '../src/utils'

test('getStatisticsSorted', () => {
  let stats = getStatisticsSorted([
    1, 2, 3, 4, 5, 6,
  ] as unknown as SortedSamples)
  expect(stats.min).toBe(1)
  expect(stats.max).toBe(6)
  expect(stats.df).toBe(5)
  expect(stats.critical).toBe(2.57058183661474)
  expect(stats.mean).toBe(3.5)
  expect(stats.variance).toBe(3.5)
  expect(stats.sd).toBe(1.8708286933869707)
  expect(stats.sem).toBe(0.7637626158259734)
  expect(stats.moe).toBe(1.9633143077276087)
  expect(stats.rme).toBe((stats.moe / stats.mean) * 100)
  expect(stats.p50).toBe(3.5)
  expect(stats.p75).toBe(4.75)
  expect(stats.p99).toBe(5.95)
  expect(stats.p995).toBe(5.975)
  expect(stats.p999).toBe(5.995)
  expect(stats.mad).toBe(1.5)
  expect(stats.aad).toBe(1.5)
  stats = getStatisticsSorted([1, 2, 3, 4, 5, 6, 7] as unknown as SortedSamples)
  expect(stats.min).toBe(1)
  expect(stats.max).toBe(7)
  expect(stats.df).toBe(6)
  expect(stats.critical).toBe(2.446911848791681)
  expect(stats.mean).toBe(4)
  expect(stats.variance).toBe(4.666666666666667)
  expect(stats.sd).toBe(2.160246899469287)
  expect(stats.sem).toBe(0.816496580927726)
  expect(stats.moe).toBe(1.9978951583699485)
  expect(stats.rme).toBe((stats.moe / stats.mean) * 100)
  expect(stats.p50).toBe(4)
  expect(stats.p75).toBe(5.5)
  expect(stats.p99).toBe(6.9399999999999995)
  expect(stats.p995).toBe(6.97)
  expect(stats.p999).toBe(6.994)
  expect(stats.mad).toBe(2)
  expect(stats.aad).toBe(1.7142857142857142)
})

test('getStatisticsSorted - sample [0]', () => {
  const stats = getStatisticsSorted([0] as unknown as SortedSamples)
  expect(stats.min).toBe(0)
  expect(stats.max).toBe(0)
  expect(stats.df).toBe(0)
  expect(stats.critical).toBe(12.706204736432102)
  expect(stats.mean).toBe(0)
  expect(stats.variance).toBe(0)
  expect(stats.sd).toBe(0)
  expect(stats.sem).toBe(0)
  expect(stats.moe).toBe(0)
  expect(stats.rme).toBe(Number.POSITIVE_INFINITY)
  expect(stats.p50).toBe(0)
  expect(stats.p75).toBe(0)
  expect(stats.p99).toBe(0)
  expect(stats.p995).toBe(0)
  expect(stats.p999).toBe(0)
  expect(stats.mad).toBe(0)
  expect(stats.aad).toBe(0)
})

test('getStatisticsSorted - big sample [0, 0, ...]', () => {
  const stats = getStatisticsSorted(
    new Array(2000).fill(0) as unknown as SortedSamples
  )
  expect(stats.min).toBe(0)
  expect(stats.max).toBe(0)
  expect(stats.df).toBe(1999)
  expect(stats.critical).toBe(1.96)
  expect(stats.mean).toBe(0)
  expect(stats.variance).toBe(0)
  expect(stats.sd).toBe(0)
  expect(stats.sem).toBe(0)
  expect(stats.moe).toBe(0)
  expect(stats.rme).toBe(Number.POSITIVE_INFINITY)
  expect(stats.p50).toBe(0)
  expect(stats.p75).toBe(0)
  expect(stats.p99).toBe(0)
  expect(stats.p995).toBe(0)
  expect(stats.p999).toBe(0)
  expect(stats.mad).toBe(0)
  expect(stats.aad).toBe(0)
})
